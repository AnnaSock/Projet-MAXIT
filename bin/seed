#!/usr/bin/env php

<?php

require_once __DIR__ . '/../vendor/autoload.php';
require_once __DIR__ . '/../app/config/env.php';

use Aks\Seeders\Seeder;

try {
    if (DB_DRIVER === 'mysql') {
        $pdo = new PDO(BASE_DSN_MYSQL, DB_USER_MYSQL, DB_PASS_MYSQL);
    } elseif (DB_DRIVER === 'pgsql') {
        $pdo = new PDO(BASE_DSN_RAILWAY, DB_USER_RAILWAY, DB_PASS_RAILWAY);
    } else {
        throw new Exception("Driver DB non pris en charge : " . DB_DRIVER);
    }

    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    echo "✅ Connexion réussie à la base de données.\n";

    try {
        $seeder = new Seeder($pdo);
        $seeder->run();
        echo "✅ Données insérées avec succès.\n";
    } catch (Exception $e) {
        echo "❌ Erreur lors du seeding : " . $e->getMessage() . "\n";
        exit(1);
    }

} catch (PDOException $e) {
    echo "❌ Erreur de connexion à la base de données : " . $e->getMessage() . "\n";
    exit(1);
} catch (Exception $e) {
    echo "❌ Erreur : " . $e->getMessage() . "\n";
    exit(1);
}
